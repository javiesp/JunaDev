{"version":3,"file":"src_app_vistas_login_login_module_ts.js","mappings":"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","sources":["./src/app/data.service.ts","./src/app/vistas/login/login-routing.module.ts","./src/app/vistas/login/login.module.ts","./src/app/vistas/login/login.page.ts"],"sourcesContent":["// data.service.ts\n\nimport { Injectable } from '@angular/core';\nimport { Storage } from '@ionic/storage-angular';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class DataService {\n  private isStorageReady = false;\n\n  constructor(private storage: Storage) {\n    this.initStorage();\n  }\n\n  // Inicializa el almacenamiento local\n  private async initStorage() {\n    // Usa el método create() para asegurarte de que la base de datos está lista\n    this.storage = await this.storage.create();\n    this.isStorageReady = true;\n  }\n\n  // Guardar información del usuario en el almacenamiento local\n  async guardarUsuario(usuario: any): Promise<void> {\n    // Verifica si el almacenamiento está listo antes de intentar guardar\n    if (!this.isStorageReady) {\n      await this.initStorage();\n    }\n\n    await this.storage.set('usuario', JSON.stringify(usuario));\n  }\n\n  // Obtener información del usuario desde el almacenamiento local\n  async obtenerUsuario(): Promise<any | null> {\n    // Verifica si el almacenamiento está listo antes de intentar obtener\n    if (!this.isStorageReady) {\n      await this.initStorage();\n    }\n\n    const usuario = await this.storage.get('usuario');\n    return usuario ? JSON.parse(usuario) : null;\n  }\n\n  // Limpiar la información del usuario al cerrar sesión\n  async cerrarSesion(): Promise<void> {\n    // Verifica si el almacenamiento está listo antes de intentar eliminar\n    if (!this.isStorageReady) {\n      await this.initStorage();\n    }\n\n    await this.storage.remove('usuario');\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { LoginPage } from './login.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: LoginPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class LoginPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { LoginPageRoutingModule } from './login-routing.module';\r\n\r\nimport { LoginPage } from './login.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    LoginPageRoutingModule\r\n  ],\r\n  declarations: [LoginPage]\r\n})\r\nexport class LoginPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { AlertController, LoadingController } from '@ionic/angular';\r\nimport {FireserviceService} from 'src/app/fireservice.service';\r\nimport { DataService } from 'src/app/data.service';\r\nimport { ChangeDetectorRef } from '@angular/core';\r\n\r\n\r\n\r\n@Component({\r\n  selector: 'app-login',\r\n  templateUrl: './login.page.html',\r\n  styleUrls: ['./login.page.scss'],\r\n})\r\nexport class LoginPage implements OnInit {\r\n  \r\n  public email:any;\r\n  public password: any;\r\n\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private loadingCtrl: LoadingController,\r\n    public fireservice:FireserviceService,\r\n    private alertController:AlertController,\r\n    private dataService: DataService,\r\n    private cdRef: ChangeDetectorRef,  // Agrega ChangeDetectorRef aquí\r\n    \r\n  ) {}\r\n  \r\n  ngOnInit() {\r\n    // Verificar si hay un usuario en el almacenamiento local al cargar la página\r\n    this.verificarUsuarioAlCargarPagina();\r\n  }\r\n\r\n  // Esta función se ejecuta cuando se presiona el botón de inicio de sesión.\r\n  async login() {\r\n    if (!this.email || !this.password) {\r\n      await this.presentAlert('Por favor, ingresa un correo electrónico y una contraseña.');\r\n      return;\r\n    }\r\n    this.showLoading();\r\n    try {\r\n      const res = await this.fireservice.loginWithEmail({ email: this.email, password: this.password });\r\n      console.log(res);\r\n      if (res.user.uid) {\r\n        this.fireservice.getDetails({ uid: res.user.uid }).subscribe(\r\n          async (userData) => {\r\n            console.log(userData);\r\n            await this.dataService.guardarUsuario(userData); // Guardar información del usuario en el almacenamiento local\r\n            this.loadingCtrl.dismiss();\r\n            this.router.navigate(['/menu-principal']);\r\n          },\r\n          (err) => {\r\n            console.log(err);\r\n            this.loadingCtrl.dismiss();\r\n          }\r\n        );\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n      // Verifica el tipo de error para mostrar el mensaje adecuado\r\n      if (err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {\r\n        await this.presentAlert('Usuario o contraseña incorrectos');\r\n      } else {\r\n        await this.presentAlert('Ocurrió un error al iniciar sesión. Por favor, intenta de nuevo más tarde.');\r\n      }\r\n      this.loadingCtrl.dismiss();\r\n    }\r\n  }\r\n  \r\n\r\n  // Verificar si hay un usuario en el almacenamiento local al cargar la página\r\n  async verificarUsuarioAlCargarPagina() {\r\n    const usuarioGuardado = await this.dataService.obtenerUsuario();\r\n    if (usuarioGuardado) {\r\n      // Si hay un usuario almacenado, navegar directamente al menú principal\r\n      this.router.navigate(['/menu-principal']);\r\n    }\r\n  }\r\n\r\n  // Función para mostrar el cuadro de alerta\r\n  async presentAlert(mensaje: string) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Alerta',\r\n      message: mensaje,\r\n      buttons: ['OK'],\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  // Función para mostrar el indicador de carga\r\n  async showLoading() {\r\n    const loading = await this.loadingCtrl.create({\r\n      message: 'Cargando...',\r\n      duration: 5000,\r\n    });\r\n    await loading.present();\r\n  }\r\n\r\n\r\n\r\n    // Esta función se ejecuta cuando se presiona el botón de registro.\r\n  // Redirige al usuario a la página de registro.\r\n  signup() {\r\n    this.router.navigate(['/registro']); // Redirige a la página de registro\r\n  }\r\n\r\n}\r\n"],"names":["Injectable","Storage","DataService","constructor","storage","initStorage","create","isStorageReady","guardarUsuario","usuario","set","JSON","stringify","obtenerUsuario","get","parse","cerrarSesion","remove","providedIn","Component","Router","AlertController","LoadingController","FireserviceService","ChangeDetectorRef","LoginPage","router","loadingCtrl","fireservice","alertController","dataService","cdRef","ngOnInit","verificarUsuarioAlCargarPagina","login","email","password","presentAlert","showLoading","res","loginWithEmail","console","log","user","uid","getDetails","subscribe","userData","dismiss","navigate","err","code","usuarioGuardado","mensaje","alert","header","message","buttons","present","loading","duration","signup","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}